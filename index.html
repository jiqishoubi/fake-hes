<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- 处理html缓存 -->
  <meta http-equiv="Expires" content="0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Cache-control" content="no-cache" />
  <meta http-equiv="Cache" content="no-cache" />
  <!-- 处理html缓存 end -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <title>历史记录(辽宁)</title>
  <script>
    document.documentElement.style.fontSize = (document.documentElement.clientWidth / 375) * 100 + 'px'
  </script>
  <link rel="stylesheet" href="./index.css" />
  <script>
    //从地址获取参数 这个是最终版本
    const getUrlParam = (key, url) => {
      if (!key) return null
      if (!url) url = window.location.href

      let vStr = ''

      const nameKeyArr = [`?${key}=`, `&${key}=`]
      let nameKey = '' // ?doctorCode=  或者  &doctorCode=
      for (let k = 0; k < nameKeyArr.length; k++) {
        if (url.indexOf(nameKeyArr[k]) > -1) {
          nameKey = nameKeyArr[k]
          break
        }
      }
      if (nameKey) {
        const containValueUrl = url.split(nameKey)[1] // 包含value的url截取
        // 有containValueUrl 就肯定是有值了
        if (containValueUrl) {
          let value
          const symbolArr = [{ symbol: '?' }, { symbol: '&' }, { symbol: '#' }] // 下一个变量的 符号
          const symbolIndexArr = symbolArr
            .map((symbolItem) => {
              return containValueUrl.indexOf(symbolItem.symbol)
            })
            .filter((index) => index > -1)
            .sort((a, b) => a - b) // index升序排列
          const symbolIndex = symbolIndexArr[0] ?? -1 // 拿到第一个（最前面的symbol的index）
          // 有符号
          if (symbolIndex > -1) {
            value = containValueUrl.substring(0, symbolIndex)
          } else {
            value = containValueUrl
          }
          vStr = value // 拿到value
        }
      }

      return decodeURIComponent(vStr) // 获取的时候 最后尝试解个码
    }

    // let date = new Date()
    // dateFormat("YYYY-mm-dd HH:MM", date)
    function dateFormat(fmt, date) {
      let ret;
      const opt = {
        "Y+": date.getFullYear().toString(),        // 年
        "m+": (date.getMonth() + 1).toString(),     // 月
        "d+": date.getDate().toString(),            // 日
        "H+": date.getHours().toString(),           // 时
        "M+": date.getMinutes().toString(),         // 分
        "S+": date.getSeconds().toString()          // 秒
        // 有其他格式化字符需求可以继续添加，必须转化成字符串
      };
      for (let k in opt) {
        ret = new RegExp("(" + k + ")").exec(fmt);
        if (ret) {
          fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")))
        };
      };
      return fmt;
    }

  </script>
  <script>
    /**
     * options:
     * name
     * pspNo
     */
    window.onload = function () {
      var userName = getUrlParam('name') || '舟'
      var pspNo = getUrlParam('pspNo') || '210703199111143010'

      // user
      userName = "*" + userName
      var showPspNo = pspNo.substring(0, 4) + '**********' + pspNo.substring(pspNo.length - 4, pspNo.length)
      document.getElementsByClassName('user_name')[0].innerHTML = userName
      document.getElementsByClassName('user_pspno')[0].innerHTML = showPspNo

      // item_list
      var count = 15 // 核酸次数
      var curStamp = new Date().getTime()
      var stampArr = []
      for (let i = 0; i < count; i++) {
        stampArr.push(curStamp - (86400000 * 2 * (i + 1)))
      }

      var dateArr = stampArr.map((stamp) => {
        return dateFormat("YYYY-mm-dd HH:MM:SS", new Date(stamp + Math.random() * 86400000 + (-16400000)))
      })

      var data = dateArr.map((dateStr) => {
        var org = ''

        if (new Date(dateStr).getTime() > new Date('2022-05-11 09:00:00').getTime()) {
          org = '建平县中医院'
        } else {
          org = '辽宁森特医学检验实验室有限公司'
        }

        return {
          time: dateStr,
          org,
        }
      })

      var itemListInnerHtml = ''
      data.forEach((item) => {
        itemListInnerHtml = itemListInnerHtml + `
          <div class='item'>
            <div class='item_time'>${item.time}</div>
            <div class='item_org'>${item.org}</div>
          </div>
        `
      })
      document.getElementsByClassName('item_list')[0].innerHTML = itemListInnerHtml
    }
  </script>
</head>

<body>
  <div class="page_content">
    <img src="./assets/tip.png" style="width: 100vw" />
    <div class="user_box">
      <div class="user_name"></div>
      <div class="user_pspno"></div>
    </div>
    <div class="item_list"></div>
  </div>
</body>

</html>